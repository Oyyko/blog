<!DOCTYPE html>
<html><head>
<title>Value_categories_in_Cpp</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  






<link rel="stylesheet" href="https://blog.oyyko.com/scss/journal.min.66a089d259edc0ecd1dc8e6fdca5e38aa0b359435198e6e33dde03adb587b099.css" integrity="sha256-ZqCJ0lntwOzR3I5v3KXjiqCzWUNRmObjPd4DrbWHsJk=" media="screen">



<link rel="stylesheet" href="https://blog.oyyko.com/scss/dark-mode.min.0ef560d9babe787e04fea51f687aaa4f4d4a510ee38d49e4b4a211af93bb6162.css" integrity="sha256-DvVg2bq&#43;eH4E/qUfaHqqT01KUQ7jjUnktKIRr5O7YWI=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>














</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://blog.oyyko.com">
    
        <div class="nav-title">
            Oyyko&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            Memento mori
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories/life">
                :Life
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories/coding">
                :Coding
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories/study">
                :Study
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2022 Oyyko&#39;s Blog
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#intro" onclick="onNavClick(`#intro-nav`)" id="intro-nav">
									Intro
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#temporary-materialization" onclick="onNavClick(`#temporary-materialization-nav`)" id="temporary-materialization-nav">
									Temporary materialization
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#decltype-and-value-categories" onclick="onNavClick(`#decltype-and-value-categories-nav`)" id="decltype-and-value-categories-nav">
									Decltype and value categories
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#stdmove" onclick="onNavClick(`#stdmove-nav`)" id="stdmove-nav">
									std::move
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories/life">
                    :Life
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories/coding">
                    :Coding
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories/study">
                    :Study
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#intro" onclick="onNavClick(`#intro-nav`)" id="intro-nav">
									Intro
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#temporary-materialization" onclick="onNavClick(`#temporary-materialization-nav`)" id="temporary-materialization-nav">
									Temporary materialization
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#decltype-and-value-categories" onclick="onNavClick(`#decltype-and-value-categories-nav`)" id="decltype-and-value-categories-nav">
									Decltype and value categories
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#stdmove" onclick="onNavClick(`#stdmove-nav`)" id="stdmove-nav">
									std::move
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://blog.oyyko.com">
            Oyyko&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://blog.oyyko.com">
        <div class="single-column-header-title">Oyyko&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">Memento mori</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Value_categories_in_Cpp
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-08-23 15:20
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/study">Study</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/cpp">Cpp</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="intro">Intro</h2>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#080">#define IS_XVALUE(expr) \
</span></span></span><span style="display:flex;"><span><span style="color:#080">(is_rvalue_reference&lt;decltype((expr))&gt;{})
</span></span></span><span style="display:flex;"><span><span style="color:#080">#define IS_PRVALUE(expr) \
</span></span></span><span style="display:flex;"><span><span style="color:#080">(!is_reference&lt;decltype((expr))&gt;{})
</span></span></span><span style="display:flex;"><span><span style="color:#080">#define IS_LVALUE(expr) \
</span></span></span><span style="display:flex;"><span><span style="color:#080">(is_lvalue_reference&lt;decltype((expr))&gt;{})
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>This is a method I recently discovered to determine which value category an <strong>expression</strong> is. I&rsquo;ll explain why it works later.</p>
<p>First, let&rsquo;s take a look at value categories in C++.</p>
<p>One of the most important things you should notice before you start is that value categories are not a property about <strong>values</strong>, but rather a property about <strong>expressions</strong>. Actually it depends on how you understand <strong>value</strong>, I looked through the C++ standard but <strong>it seems they don&rsquo;t define what the term value means</strong>. However, we all know what an expression is. (in case you don&rsquo;t know, you can refer to cppreference)</p>
<p>Anyway, there are 3 kinds of value categories. They are called LVALUE, PRVALUE, XVALUE.</p>
<p>We know you can write x=3 but not 3=x. Since 3 and x are both expressions, there must be some qualitative difference between them. Since x can be placed to the left of the equals sign(assignment sign), so we call it an lvalue. 3 is called an rvalue accordingly.</p>
<p>OK. Now I know the difference between LVALUE and RVALUE, but what is PRVALUE and XVALUE?</p>
<p>Well, there are two dimensions to the form of expressions. 1. Does the expression have an identity? 2. Can the expression be moved?</p>
<p>The one that has identity and can be moved is called XVALUE (eXpiring value).
The one that has identity but cannot be moved is called LVALUE.
The one that has no identity but can be moved is called PRVALUE.</p>
<p>For example, these are examples for XVALUE:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>std<span style="color:#666">::</span>move(x);
</span></span><span style="display:flex;"><span>a.m, the member of object expression, where a is an rvalue and m is a non<span style="color:#666">-</span><span style="color:#a2f;font-weight:bold">static</span> data member of non<span style="color:#666">-</span>reference type;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="temporary-materialization">Temporary materialization</h2>
<p>The most useful example to help you understand XVALUE is: Temporary materialization.</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">struct</span> <span style="color:#00f">S</span> { <span style="color:#0b0;font-weight:bold">int</span> m; };
</span></span><span style="display:flex;"><span><span style="color:#0b0;font-weight:bold">int</span> i <span style="color:#666">=</span> S().m; <span style="color:#080;font-style:italic">// member access expects glvalue as of C++17;
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span>               <span style="color:#080;font-style:italic">// S() prvalue is converted to xvalue
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>As the cppreference goes: A prvalue of any complete type T can be converted to an xvalue of the same type T. This conversion initializes a temporary object of type T from the prvalue by evaluating the prvalue with the temporary object as its result object, and produces an xvalue denoting the temporary object. If T is a class or array of class type, it must have an accessible and non-deleted destructor.</p>
<p>So the key difference between XVALUE and PRVALUE is that can we <strong>reuse</strong> the resources of it. We cannot reuse the number 3 or 3.7 but <strong>we can reuse the memory allocated for a temporary string object</strong>.</p>
<h2 id="decltype-and-value-categories">Decltype and value categories</h2>
<p>Decltype is a good tool to help us determine the category of an expression.</p>
<p>Because its behavior is to generate an rvalue reference for XVALUE, an unreferenced type for PRVALUE, and an lvalue reference for LVALUE.</p>
<p>Well, someone may argue that if <code>int x=3;</code> then <code>x is an LVALUE but decltype(x) is int itself rather than int&amp;.</code> That&rsquo;s because the special case for id-expr in the behavior of decltype.</p>
<p>If the argument is an unparenthesized id-expression or an unparenthesized class member access expression, then decltype yields the type of the entity named by this expression. If there is no such entity, or if the argument names a set of overloaded functions, the program is ill-formed.</p>
<p>So the right way is <code>int x=3; decltype((x)) xref=x;</code>. Here the type of <code>xref</code> is <code>int&amp;</code>.</p>
<h2 id="stdmove">std::move</h2>
<p>The famous function <code>move</code> actually does nothing to do with &ldquo;move something&rdquo;. Actually, it just change the value category of the parameter from LVALUE to XVALUE. In the most cases, you should call move using an LVALUE.</p>
<p>std::move is used to <strong>indicate</strong> that an object t may be &ldquo;moved from&rdquo;, i.e. allowing the efficient transfer of resources from t to another object.</p>
<p>In particular, std::move produces an xvalue expression that identifies its argument t. It is exactly equivalent to a static_cast to an rvalue reference type.</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2022-09-21</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts">
			Next<br>No newer posts.
                </a>
                
                
                
                <a class="older-posts" href="https://blog.oyyko.com/posts/revisit_os/">
			Previous<br>Revisit_OS
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










<script src="https://utteranc.es/client.js"
        repo="Oyyko/utteranc-comments"
        issue-term="pathname"
        label=""
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2022 Oyyko&#39;s Blog
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
