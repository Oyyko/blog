<!DOCTYPE html>
<html><head>
<title>Texmacs/Mogan Note 2</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">















  




<link rel="icon" href="https://avatars.githubusercontent.com/u/66729335?v=4">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_15" class="nav-23_15">
									23_15
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_7" class="nav-23_7">
									23_7
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%97%ae%e9%a2%98" class="nav-问题">
									问题
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bc%96%e8%af%91%e6%97%b6%e5%80%99%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98" class="nav-编译时候出现问题">
									编译时候出现问题
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_14" class="nav-23_14">
									23_14
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_14-bug" class="nav-23_14-bug">
									23_14 Bug
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%a0%94%e7%a9%b6-get-env-tree" class="nav-研究-get-env-tree">
									研究 get-env-tree
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%bc%a0%e6%a0%87%e7%82%b9%e5%87%bb%e7%a0%94%e7%a9%b6" class="nav-鼠标点击研究">
									鼠标点击研究
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://blog.oyyko.com">
            Oyyko&#39;s Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://blog.oyyko.com">
        <div class="single-column-header-title">Oyyko&#39;s Blog</div>
        
        <div class="single-column-header-subtitle">Being towards death</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Texmacs/Mogan Note 2
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2023-07-13 00:00
                        </time>
                        

                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/note">note</a>
                                &nbsp;
                            
                                <a href="/tags/code">code</a>
                                &nbsp;
                            
                                <a href="/tags/mogan">mogan</a>
                                &nbsp;
                            
                                <a href="/tags/texmacs">texmacs</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="23_15">23_15</h1>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">get-init-tree</span> <span style="color:#98c379">&#34;text-at-halign&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个与缓存有关。缓存位置在<code>~/.Texmacs/</code>。如果不更改缓存，更改源代码不会生效。</p>
<h1 id="23_7">23_7</h1>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">graphics-release-left</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#8a93a5;font-style:italic">;;(display* &#34;Graphics] Release-left &#34; x &#34;, &#34; y &#34;\n&#34;)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#c678dd">if </span>(<span style="color:#00b1f7">inside-graphical-text?</span>)
</span></span><span style="display:flex;"><span>      (<span style="color:#00b1f7">with-innermost</span> <span style="color:#dcaeea">t</span> <span style="color:#dcaeea">graphical-text-context?</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#c678dd">let* </span>((<span style="color:#00b1f7">ps</span> (<span style="color:#00b1f7">select-first</span> (<span style="color:#00b1f7">s2f</span> <span style="color:#dcaeea">x</span>) (<span style="color:#00b1f7">s2f</span> <span style="color:#dcaeea">y</span>)))
</span></span><span style="display:flex;"><span>               (<span style="color:#00b1f7">p</span> (<span style="color:#c678dd">and </span><span style="color:#dcaeea">ps</span> (<span style="color:#ef8383">car </span><span style="color:#dcaeea">ps</span>))))
</span></span><span style="display:flex;"><span>          (<span style="color:#c678dd">if </span>(<span style="color:#c678dd">and </span><span style="color:#dcaeea">p</span> (<span style="color:#00b1f7">list-starts?</span> <span style="color:#dcaeea">p</span> (<span style="color:#00b1f7">tree-&gt;path</span> <span style="color:#dcaeea">t</span>)))
</span></span><span style="display:flex;"><span>              (<span style="color:#00b1f7">go-to</span> <span style="color:#dcaeea">p</span>)
</span></span><span style="display:flex;"><span>              (<span style="color:#00b1f7">tree-go-to</span> <span style="color:#dcaeea">t</span> <span style="color:#dcaeea">:start</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#00b1f7">edit_left-button</span> (<span style="color:#ef8383">car </span>(<span style="color:#00b1f7">graphics-mode</span>)) <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)))
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">get-keyboard-modifiers</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#dcaeea">the-keyboard-modifiers</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">set-keyboard-modifiers</span> <span style="color:#dcaeea">mods</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#c678dd">set! </span><span style="color:#dcaeea">the-keyboard-modifiers</span> <span style="color:#dcaeea">mods</span>))
</span></span></code></pre></td></tr></table>
</div>
</div><p>结论：https://github.com/XmacsLabs/mogan/pull/796</p>
<h1 id="问题">问题</h1>
<ol>
<li>.ts文件怎么使用</li>
<li>C++代码中有很多字符串类型的东西可以用枚举类型来替代，可以重构一下？</li>
<li>绘图模式有没有给座标系标注1、2、3的模式</li>
</ol>
<h1 id="编译时候出现问题">编译时候出现问题</h1>
<pre tabindex="0"><code>generating scheme glueA glue_font ... ok
generating scheme glueA glue_analyze ... ok
generating scheme glueA glue_drd ... ok
installing libmogan ..
error: install failed, method &#39;trim&#39; is not callable (a nil value)
</code></pre><p>看起来是lua语言中的trim方法无法调用。
结论：有一个环境变量字符串被设置为nil，之后在他的上面调用trim方法则报错。</p>
<h1 id="23_14">23_14</h1>
<p><code>edit_interface_rep::handle_mouse</code> 处理鼠标事件。</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#c1abea">edit_interface_rep</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">handle_mouse</span> (<span style="color:#c1abea">string</span> <span style="color:#c1abea">kind</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">x</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">y</span>, <span style="color:#ef8383">int</span> <span style="color:#c1abea">m</span>, <span style="color:#c1abea">time_t</span> <span style="color:#c1abea">t</span>,
</span></span><span style="display:flex;"><span>                                  <span style="color:#c1abea">array</span><span style="color:#c7bf54">&lt;</span><span style="color:#ef8383">double</span><span style="color:#c7bf54">&gt;</span> <span style="color:#c1abea">data</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>kind的类型可以有move, press-left, release-left, press-right 等。</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#c678dd">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#c1abea">string</span> <span style="color:#c1abea">rew</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">kind</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#c1abea">SI</span> <span style="color:#c1abea">dist</span><span style="color:#c7bf54">=</span> (<span style="color:#c1abea">SI</span>) (<span style="color:#d19a66">5</span> <span style="color:#c7bf54">*</span> <span style="color:#c1abea">PIXEL</span> <span style="color:#c7bf54">/</span> <span style="color:#c1abea">magf</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#c1abea">rew</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">detect_left_drag</span> ((<span style="color:#ef8383">void</span><span style="color:#c7bf54">*</span>) <span style="color:#c678dd">this</span>, <span style="color:#c1abea">rew</span>, <span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>, <span style="color:#c1abea">t</span>, <span style="color:#c1abea">m</span>, <span style="color:#c1abea">dist</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#c1abea">rew</span> <span style="color:#c7bf54">==</span> <span style="color:#98c379">&#34;start-drag-left&#34;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">call_mouse_event</span> (<span style="color:#c1abea">rew</span>, <span style="color:#c1abea">left_x</span>, <span style="color:#c1abea">left_y</span>, <span style="color:#c1abea">m</span>, <span style="color:#c1abea">t</span>, <span style="color:#c1abea">data</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">delayed_call_mouse_event</span> (<span style="color:#98c379">&#34;dragging-left&#34;</span>, <span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>, <span style="color:#c1abea">m</span>, <span style="color:#c1abea">t</span>, <span style="color:#c1abea">data</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">rew</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">detect_right_drag</span> ((<span style="color:#ef8383">void</span><span style="color:#c7bf54">*</span>) <span style="color:#c678dd">this</span>, <span style="color:#c1abea">rew</span>, <span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>, <span style="color:#c1abea">t</span>, <span style="color:#c1abea">m</span>, <span style="color:#c1abea">dist</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#c678dd">if</span> (<span style="color:#c1abea">rew</span> <span style="color:#c7bf54">==</span> <span style="color:#98c379">&#34;start-drag-right&#34;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#c1abea">call_mouse_event</span> (<span style="color:#c1abea">rew</span>, <span style="color:#c1abea">right_x</span>, <span style="color:#c1abea">right_y</span>, <span style="color:#c1abea">m</span>, <span style="color:#c1abea">t</span>, <span style="color:#c1abea">data</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#c1abea">delayed_call_mouse_event</span> (<span style="color:#98c379">&#34;dragging-right&#34;</span>, <span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>, <span style="color:#c1abea">m</span>, <span style="color:#c1abea">t</span>, <span style="color:#c1abea">data</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#c678dd">else</span> <span style="color:#00b1f7">call_mouse_event</span> (<span style="color:#c1abea">rew</span>, <span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>, <span style="color:#c1abea">m</span>, <span style="color:#c1abea">t</span>, <span style="color:#c1abea">data</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>这段检测了是否有拖动发生，如果没有，最终会执行<code>call_mouse_event (rew, x, y, m, t, data);</code></p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#c678dd">static</span> <span style="color:#ef8383">void</span>
</span></span><span style="display:flex;"><span><span style="color:#00b1f7">call_mouse_event</span> (<span style="color:#c1abea">string</span> <span style="color:#c1abea">kind</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">x</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">y</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">m</span>, <span style="color:#c1abea">time_t</span> <span style="color:#c1abea">t</span>, <span style="color:#c1abea">array</span><span style="color:#c7bf54">&lt;</span><span style="color:#ef8383">double</span><span style="color:#c7bf54">&gt;</span> <span style="color:#c1abea">d</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">array</span><span style="color:#c7bf54">&lt;</span><span style="color:#c1abea">object</span><span style="color:#c7bf54">&gt;</span> <span style="color:#c1abea">args</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">args</span> <span style="color:#c7bf54">&lt;&lt;</span> <span style="color:#c1abea">object</span> (<span style="color:#c1abea">kind</span>) <span style="color:#c7bf54">&lt;&lt;</span> <span style="color:#c1abea">object</span> (<span style="color:#c1abea">x</span>) <span style="color:#c7bf54">&lt;&lt;</span> <span style="color:#c1abea">object</span> (<span style="color:#c1abea">y</span>)
</span></span><span style="display:flex;"><span>       <span style="color:#c7bf54">&lt;&lt;</span> <span style="color:#c1abea">object</span> (<span style="color:#c1abea">m</span>) <span style="color:#c7bf54">&lt;&lt;</span> <span style="color:#c1abea">object</span> ((<span style="color:#ef8383">double</span>) <span style="color:#c1abea">t</span>) <span style="color:#c7bf54">&lt;&lt;</span> <span style="color:#c1abea">object</span> (<span style="color:#c1abea">d</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">call</span> (<span style="color:#98c379">&#34;mouse-event&#34;</span>, <span style="color:#c1abea">args</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后转发给scheme来处理。</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">mouse-event</span> <span style="color:#dcaeea">key</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span> <span style="color:#dcaeea">mods</span> <span style="color:#dcaeea">time</span> <span style="color:#dcaeea">data</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#8a93a5;font-style:italic">;;(display* &#34;mouse-event &#34; key &#34;, &#34; x &#34;, &#34; y &#34;, &#34; mods &#34;, &#34; time &#34;, &#34; data &#34;\n&#34;)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00b1f7">mouse-any</span> <span style="color:#dcaeea">key</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span> <span style="color:#dcaeea">mods</span> (<span style="color:#ef8383">+ </span><span style="color:#dcaeea">time</span> <span style="color:#d19a66">0.0</span>) <span style="color:#dcaeea">data</span>))
</span></span></code></pre></td></tr></table>
</div>
</div><p>转到<code>mouse-any</code></p>
<p><code>mouse-any</code>再转回C++</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>                <span style="color:#c1abea">scm_name</span> <span style="color:#c7bf54">=</span> <span style="color:#63c381">&#34;mouse-any&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#c1abea">cpp_name</span> <span style="color:#c7bf54">=</span> <span style="color:#63c381">&#34;mouse_any&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#c1abea">ret_type</span> <span style="color:#c7bf54">=</span> <span style="color:#63c381">&#34;void&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#c1abea">arg_list</span> <span style="color:#c7bf54">=</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#63c381">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#63c381">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#63c381">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#63c381">&#34;int&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#63c381">&#34;double&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#63c381">&#34;array_double&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>mouse_any</code>中进行dispatch.</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>  <span style="color:#c678dd">if</span> (<span style="color:#c1abea">type</span> <span style="color:#c7bf54">==</span> <span style="color:#98c379">&#34;press-left&#34;</span> <span style="color:#c7bf54">||</span> <span style="color:#c1abea">type</span> <span style="color:#c7bf54">==</span> <span style="color:#98c379">&#34;start-drag-left&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#c1abea">mods</span> <span style="color:#c7bf54">&gt;</span> <span style="color:#d19a66">1</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">mouse_adjusting</span> <span style="color:#c7bf54">=</span> <span style="color:#c1abea">mods</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">mouse_adjust_selection</span>(<span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>, <span style="color:#c1abea">mods</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#00b1f7">mouse_click</span> (<span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>);
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这里进入mouse_click函数</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ef8383">void</span>
</span></span><span style="display:flex;"><span><span style="color:#c1abea">edit_interface_rep</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">mouse_click</span> (<span style="color:#c1abea">SI</span> <span style="color:#c1abea">x</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">y</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#c678dd">if</span> (<span style="color:#c1abea">mouse_message</span> (<span style="color:#98c379">&#34;click&#34;</span>, <span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>)) <span style="color:#c678dd">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">start_x</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">x</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">start_y</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">y</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">send_mouse_grab</span> (<span style="color:#c678dd">this</span>, <span style="color:#ef8383">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>思路改为倒着找，从绘图的移动功能出发。因为只需要在绘图上进行改变鼠标样式的操作，而改变鼠标样式(<code>setCursor</code>)是依赖于具体的widget来执行的。</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">edit_move</span> <span style="color:#dcaeea">mode</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">graphics-move</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#8a93a5;font-style:italic">;;(display* &#34;Graphics] Move &#34; x &#34;, &#34; y &#34;\n&#34;)</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#00b1f7">when</span> (<span style="color:#ef8383">not </span>(<span style="color:#00b1f7">inside-graphical-text?</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#00b1f7">edit_move</span> (<span style="color:#ef8383">car </span>(<span style="color:#00b1f7">graphics-mode</span>)) <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)))
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据<code>(&quot;Move objects&quot; (graphics-set-mode '(group-edit move)))</code>, 应该重载到group-edit版本。</p>
<p>测试发现正确:</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">edit_move</span> <span style="color:#dcaeea">mode</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00b1f7">:require</span> (<span style="color:#ef8383">eq? </span><span style="color:#dcaeea">mode</span> <span style="color:#56b6c2">&#39;group-edit</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#00b1f7">:state</span> <span style="color:#dcaeea">graphics-state</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00b1f7">display*</span> <span style="color:#98c379">&#34;HERE\n&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#c678dd">cond </span>(<span style="color:#00b1f7">sticky-point</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#c678dd">set! </span><span style="color:#dcaeea">x</span> (<span style="color:#00b1f7">s2f</span> <span style="color:#dcaeea">x</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#c678dd">set! </span><span style="color:#dcaeea">y</span> (<span style="color:#00b1f7">s2f</span> <span style="color:#dcaeea">y</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#00b1f7">with</span> <span style="color:#dcaeea">mode</span> (<span style="color:#00b1f7">graphics-mode</span>)
</span></span><span style="display:flex;"><span>           (<span style="color:#c678dd">cond </span>((<span style="color:#00b1f7">==</span> (<span style="color:#ef8383">cadr </span><span style="color:#dcaeea">mode</span>) <span style="color:#56b6c2">&#39;move</span>)
</span></span><span style="display:flex;"><span>                  (<span style="color:#00b1f7">sketch-transform</span>
</span></span><span style="display:flex;"><span>                   (<span style="color:#00b1f7">group-translate</span> (<span style="color:#ef8383">- </span><span style="color:#dcaeea">x</span> <span style="color:#dcaeea">group-old-x</span>)
</span></span><span style="display:flex;"><span>                                    (<span style="color:#ef8383">- </span><span style="color:#dcaeea">y</span> <span style="color:#dcaeea">group-old-y</span>))))
</span></span><span style="display:flex;"><span>                 ((<span style="color:#00b1f7">==</span> (<span style="color:#ef8383">cadr </span><span style="color:#dcaeea">mode</span>) <span style="color:#56b6c2">&#39;zoom</span>)
</span></span><span style="display:flex;"><span>                  (<span style="color:#00b1f7">sketch-set!</span> <span style="color:#dcaeea">group-first-go</span>)
</span></span><span style="display:flex;"><span>                  (<span style="color:#00b1f7">sketch-transform</span> (<span style="color:#00b1f7">group-zoom</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)))
</span></span><span style="display:flex;"><span>                 ((<span style="color:#00b1f7">==</span> (<span style="color:#ef8383">cadr </span><span style="color:#dcaeea">mode</span>) <span style="color:#56b6c2">&#39;rotate</span>)
</span></span><span style="display:flex;"><span>                  (<span style="color:#00b1f7">sketch-set!</span> <span style="color:#dcaeea">group-first-go</span>)
</span></span><span style="display:flex;"><span>                  (<span style="color:#00b1f7">sketch-transform</span> (<span style="color:#00b1f7">group-rotate</span> <span style="color:#dcaeea">x</span> <span style="color:#dcaeea">y</span>)))))
</span></span><span style="display:flex;"><span>         (<span style="color:#c678dd">set! </span><span style="color:#dcaeea">group-old-x</span> <span style="color:#dcaeea">x</span>)
</span></span><span style="display:flex;"><span>         (<span style="color:#c678dd">set! </span><span style="color:#dcaeea">group-old-y</span> <span style="color:#dcaeea">y</span>))
</span></span><span style="display:flex;"><span>        (<span style="color:#00b1f7">multiselecting</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#00b1f7">graphical-object!</span>
</span></span><span style="display:flex;"><span>          (<span style="color:#00b1f7">append</span>
</span></span><span style="display:flex;"><span>           (<span style="color:#00b1f7">create-graphical-props</span> <span style="color:#56b6c2">&#39;default</span> <span style="color:#b756ff;font-weight:bold">#f</span>)
</span></span><span style="display:flex;"><span>           <span style="color:#c7bf54">`</span>((<span style="color:#00b1f7">with</span> <span style="color:#dcaeea">color</span> <span style="color:#dcaeea">red</span>
</span></span><span style="display:flex;"><span>               (<span style="color:#00b1f7">cline</span> (<span style="color:#00b1f7">point</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">selecting-x0</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">selecting-y0</span>)
</span></span><span style="display:flex;"><span>                      (<span style="color:#00b1f7">point</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">x</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">selecting-y0</span>)
</span></span><span style="display:flex;"><span>                      (<span style="color:#00b1f7">point</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">x</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">y</span>)
</span></span><span style="display:flex;"><span>                      (<span style="color:#00b1f7">point</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">selecting-x0</span> <span style="color:#c7bf54">,</span><span style="color:#dcaeea">y</span>)))))))
</span></span><span style="display:flex;"><span>        (<span style="color:#00b1f7">else</span>
</span></span><span style="display:flex;"><span>          (<span style="color:#c678dd">cond </span>(<span style="color:#00b1f7">current-path</span>
</span></span><span style="display:flex;"><span>                 (<span style="color:#00b1f7">set-message</span> (<span style="color:#ef8383">string-append </span><span style="color:#98c379">&#34;Left click: operate; &#34;</span>
</span></span><span style="display:flex;"><span>                                             <span style="color:#98c379">&#34;Shift+Left click or Right click: select/unselect&#34;</span>)
</span></span><span style="display:flex;"><span>                              <span style="color:#98c379">&#34;Group of objects&#34;</span>))
</span></span><span style="display:flex;"><span>                ((<span style="color:#00b1f7">nnull?</span> (<span style="color:#00b1f7">sketch-get</span>))
</span></span><span style="display:flex;"><span>                 (<span style="color:#00b1f7">set-message</span> <span style="color:#98c379">&#34;Left click: operate&#34;</span>
</span></span><span style="display:flex;"><span>                              <span style="color:#98c379">&#34;Group of objects&#34;</span>))
</span></span><span style="display:flex;"><span>                (<span style="color:#00b1f7">else</span>
</span></span><span style="display:flex;"><span>                  (<span style="color:#00b1f7">set-message</span> <span style="color:#98c379">&#34;Move over object on which to operate&#34;</span>
</span></span><span style="display:flex;"><span>                               <span style="color:#98c379">&#34;Edit groups of objects&#34;</span>)))
</span></span><span style="display:flex;"><span>          (<span style="color:#00b1f7">graphics-decorations-update</span>))))
</span></span></code></pre></td></tr></table>
</div>
</div><p>之后倒到<code>edit_graphics.cpp</code>中的:</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ef8383">bool</span>
</span></span><span style="display:flex;"><span><span style="color:#c1abea">edit_graphics_rep</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">mouse_graphics</span> (<span style="color:#c1abea">string</span> <span style="color:#c1abea">type</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">x</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">y</span>, <span style="color:#ef8383">int</span> <span style="color:#c1abea">mods</span>, <span style="color:#c1abea">time_t</span> <span style="color:#c1abea">t</span>,
</span></span><span style="display:flex;"><span>                                   <span style="color:#c1abea">array</span><span style="color:#c7bf54">&lt;</span><span style="color:#ef8383">double</span><span style="color:#c7bf54">&gt;</span> <span style="color:#c1abea">data</span>) {
</span></span></code></pre></td></tr></table>
</div>
</div><p>倒退到</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ef8383">bool</span>
</span></span><span style="display:flex;"><span><span style="color:#c1abea">edit_graphics_rep</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">mouse_graphics</span> (<span style="color:#c1abea">string</span> <span style="color:#c1abea">type</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">x</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">y</span>, <span style="color:#ef8383">int</span> <span style="color:#c1abea">mods</span>, <span style="color:#c1abea">time_t</span> <span style="color:#c1abea">t</span>,
</span></span><span style="display:flex;"><span>                                   <span style="color:#c1abea">array</span><span style="color:#c7bf54">&lt;</span><span style="color:#ef8383">double</span><span style="color:#c7bf54">&gt;</span> <span style="color:#c1abea">data</span>) {
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后倒退到scheme中。没找到可以利用的。</p>
<p>换思路，搜索<code>: public QWidget</code>,看都有谁继承了。因为setCursor是它的成员函数。QtMainWindow也是Qt库中的，它也继承了QWidget.</p>
<p>看不出。直接看主界面怎么生成的吧。</p>
<p><code>qt_tm_widget.hpp</code>中写了：</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>  <span style="color:#c1abea">QMainWindow</span><span style="color:#c7bf54">*</span> <span style="color:#00b1f7">mainwindow</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">return</span> <span style="color:#c1abea">qobject_cast</span><span style="color:#c7bf54">&lt;</span><span style="color:#c1abea">QMainWindow</span><span style="color:#c7bf54">*&gt;</span> (<span style="color:#c1abea">qwid</span>); 
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个函数可以获取主页面的QWidget. 但它仍然是一个成员函数所以可能不太对。</p>
<p>在<code>qt_dialogues.cpp</code>中,发现了</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span> <span style="color:#c1abea">QWidget</span><span style="color:#c7bf54">*</span> <span style="color:#c1abea">mainwindow</span> <span style="color:#c7bf54">=</span> <span style="color:#c1abea">QApplication</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">activeWindow</span> ();
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个可能是Qt自带的找到当前活跃窗口的函数。</p>
<h1 id="23_14-bug">23_14 Bug</h1>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scheme" data-lang="scheme"><span style="display:flex;"><span>(<span style="color:#00b1f7">tm-define</span> (<span style="color:#00b1f7">graphics-get-property</span> <span style="color:#dcaeea">var</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00b1f7">with</span> <span style="color:#dcaeea">val</span> (<span style="color:#00b1f7">graphics-get-raw-property</span> <span style="color:#dcaeea">var</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#00b1f7">tm-&gt;stree</span> <span style="color:#dcaeea">val</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#c678dd">define </span>(<span style="color:#00b1f7">graphics-get-raw-property</span> <span style="color:#dcaeea">var</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#00b1f7">with</span> <span style="color:#dcaeea">val</span> (<span style="color:#00b1f7">get-upwards-tree-property</span> (<span style="color:#00b1f7">graphics-graphics-path</span>) <span style="color:#dcaeea">var</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#c678dd">if </span>(<span style="color:#ef8383">eq? </span><span style="color:#dcaeea">val</span> <span style="color:#dcaeea">nothing</span>)
</span></span><span style="display:flex;"><span>        (<span style="color:#00b1f7">get-default-tree-val</span> <span style="color:#dcaeea">var</span>)
</span></span><span style="display:flex;"><span>        (<span style="color:#c678dd">if </span>(<span style="color:#ef8383">eq? </span>(<span style="color:#00b1f7">tm-car</span> <span style="color:#dcaeea">val</span>) <span style="color:#56b6c2">&#39;quote</span>)
</span></span><span style="display:flex;"><span>            (<span style="color:#00b1f7">tree-ref</span> <span style="color:#dcaeea">val</span> <span style="color:#d19a66">0</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#dcaeea">val</span>))))
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="研究-get-env-tree">研究 get-env-tree</h2>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#c1abea">tree</span>
</span></span><span style="display:flex;"><span><span style="color:#c1abea">edit_typeset_rep</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">get_env_value</span> (<span style="color:#c1abea">string</span> <span style="color:#c1abea">var</span>, <span style="color:#c1abea">path</span> <span style="color:#c1abea">p</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">typeset_exec_until</span> (<span style="color:#c1abea">p</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">tree</span> <span style="color:#c1abea">t</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">cur</span>[<span style="color:#c1abea">p</span>][<span style="color:#c1abea">var</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#c678dd">return</span> <span style="color:#00b1f7">is_func</span> (<span style="color:#c1abea">t</span>, <span style="color:#c1abea">BACKUP</span>, <span style="color:#d19a66">2</span>)<span style="color:#c7bf54">?</span> <span style="color:#c1abea">t</span>[<span style="color:#d19a66">0</span>]<span style="color:#c7bf54">:</span> <span style="color:#c1abea">t</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="鼠标点击研究">鼠标点击研究</h2>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>  <span style="color:#c678dd">if</span> (<span style="color:#c1abea">type</span> <span style="color:#c7bf54">==</span> <span style="color:#98c379">&#34;press-left&#34;</span> <span style="color:#c7bf54">||</span> <span style="color:#c1abea">type</span> <span style="color:#c7bf54">==</span> <span style="color:#98c379">&#34;start-drag-left&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">if</span> (<span style="color:#c1abea">mods</span> <span style="color:#c7bf54">&gt;</span> <span style="color:#d19a66">1</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">mouse_adjusting</span> <span style="color:#c7bf54">=</span> <span style="color:#c1abea">mods</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">mouse_adjust_selection</span>(<span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>, <span style="color:#c1abea">mods</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#c678dd">else</span>
</span></span><span style="display:flex;"><span>      <span style="color:#00b1f7">mouse_click</span> (<span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>);
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>之后进入</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ef8383">void</span>
</span></span><span style="display:flex;"><span><span style="color:#c1abea">edit_interface_rep</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">mouse_click</span> (<span style="color:#c1abea">SI</span> <span style="color:#c1abea">x</span>, <span style="color:#c1abea">SI</span> <span style="color:#c1abea">y</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">cout</span> <span style="color:#c7bf54">&lt;&lt;</span> <span style="color:#98c379">&#34;DEBUG: &#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c678dd">if</span> (<span style="color:#c1abea">mouse_message</span> (<span style="color:#98c379">&#34;click&#34;</span>, <span style="color:#c1abea">x</span>, <span style="color:#c1abea">y</span>)) <span style="color:#c678dd">return</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">start_x</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">x</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">start_y</span><span style="color:#c7bf54">=</span> <span style="color:#c1abea">y</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#c1abea">send_mouse_grab</span> (<span style="color:#c678dd">this</span>, <span style="color:#ef8383">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>之后</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#c678dd">inline</span> <span style="color:#ef8383">void</span>
</span></span><span style="display:flex;"><span><span style="color:#00b1f7">send_mouse_grab</span> (<span style="color:#c1abea">widget</span> <span style="color:#c1abea">w</span>, <span style="color:#ef8383">bool</span> <span style="color:#c1abea">get_grab</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#8a93a5;font-style:italic">// request a mouse grab for the widget
</span></span></span><span style="display:flex;"><span><span style="color:#8a93a5;font-style:italic"></span>  <span style="color:#c1abea">send</span><span style="color:#c7bf54">&lt;</span><span style="color:#ef8383">bool</span><span style="color:#c7bf54">&gt;</span> (<span style="color:#c1abea">w</span>, <span style="color:#c1abea">SLOT_MOUSE_GRAB</span>, <span style="color:#c1abea">get_grab</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这里似乎捕获了</p>
<div class="highlight"><div style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#58626f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ef8383">void</span>
</span></span><span style="display:flex;"><span><span style="color:#c1abea">qt_tm_widget_rep</span><span style="color:#c7bf54">::</span><span style="color:#c1abea">send</span> (<span style="color:#c1abea">slot</span> <span style="color:#c1abea">s</span>, <span style="color:#c1abea">blackbox</span> <span style="color:#c1abea">val</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#c678dd">switch</span> (<span style="color:#c1abea">s</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">case</span> <span style="color:#f5a40d">SLOT_INVALIDATE</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">case</span> <span style="color:#f5a40d">SLOT_INVALIDATE_ALL</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">case</span> <span style="color:#f5a40d">SLOT_EXTENTS</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">case</span> <span style="color:#f5a40d">SLOT_SCROLL_POSITION</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">case</span> <span style="color:#f5a40d">SLOT_ZOOM_FACTOR</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#c678dd">case</span> <span style="color:#f5a40d">SLOT_MOUSE_GRAB</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#c1abea">main_widget</span><span style="color:#c7bf54">-&gt;</span><span style="color:#c1abea">send</span>(<span style="color:#c1abea">s</span>, <span style="color:#c1abea">val</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#c678dd">return</span>;
</span></span></code></pre></td></tr></table>
</div>
</div>
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2023-07-17</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/vscode2/">
			Next<br>Vscode 返回上一个位置快捷键
                </a>
                
                
                
                <a class="older-posts" href="/posts/arch_install/">
			Previous<br>Archlinux/Manjaro Install Guide
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










<script src="https://utteranc.es/client.js"
        repo="Oyyko/utteranc-comments"
        issue-term="pathname"
        label=""
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://blog.oyyko.com">
    
        <div class="nav-title">
            Oyyko&#39;s Blog
        </div>
        
        <div class="nav-subtitle">
            Being towards death
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2023 Oyyko&#39;s Blog
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_15" class="nav-23_15">
									23_15
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_7" class="nav-23_7">
									23_7
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%97%ae%e9%a2%98" class="nav-问题">
									问题
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%bc%96%e8%af%91%e6%97%b6%e5%80%99%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98" class="nav-编译时候出现问题">
									编译时候出现问题
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_14" class="nav-23_14">
									23_14
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#23_14-bug" class="nav-23_14-bug">
									23_14 Bug
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%a0%94%e7%a9%b6-get-env-tree" class="nav-研究-get-env-tree">
									研究 get-env-tree
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%bc%a0%e6%a0%87%e7%82%b9%e5%87%bb%e7%a0%94%e7%a9%b6" class="nav-鼠标点击研究">
									鼠标点击研究
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2023 Oyyko&#39;s Blog
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
